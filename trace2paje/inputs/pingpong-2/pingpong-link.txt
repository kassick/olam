CONTAINER ROOT {

  LINKTYPE PingLink FROM Rank TO Rank {
    ping
  }

  CONTAINER Cluster {
    NAME "%(my_cluster)"
    CREATE init
    DESTROY finalize


    CONTAINER Machine {
      NAME "%(my_hostname)"

      CONTAINER Rank {
        NAME "rank_%(rank)"
        CREATE PARENT
        DESTROY PARENT
      
        STATETYPE PingState {
          ping_s
          ping_r
        }


      }

    }
  }
}

LINK ping {
  #VALUE "msg_%(src).%(tag)"
  VALUE START "msg_to_%(otherrank)"
  VALUE END "msg_to_%(rank)"
  KEY START "%(rank)##%(tag)##%(otherrank)"
  KEY END "%(otherrank)##%(tag)##%(rank)"
  i tag
  i otherrank
}

STATE ping_s {
  i tag
  i dst
}

STATE ping_r {
  i tag
  i src
}

EVENT init {
  s cluster
  s hostname
  PUSH hostname AS my_hostname
  PUSH cluster AS my_cluster
}

EVENT finalize {
  VALUE "%(EVT_NAME)"
}

ID ping_s START 4001
ID ping_r END 4002
ID ping   4001 4002
